---
import Editor from "@components/wp-blocks/editor/Block.astro";

// Auto-load all wp-blocks/*/Block.astro and key them by folder name
const modules = import.meta.glob("@components/wp-blocks/**/Block.astro", {
  eager: true,
});

const blocks = Object.fromEntries(
  Object.entries(modules).map(([path, mod]) => {
    const parts = path.split("/");
    // folder right before Block.astro becomes the layout key
    const key = parts[parts.length - 2];
    return [key, (mod as any).default];
  }),
);

const { items } = Astro.props;
---

{
  items &&
    items.map((block, index) => {
      const layout = block.acf_fc_layout;
      const BlockComponent = blocks[layout] || Editor;
      {
        return <BlockComponent content={block} index={index + 1} />;
      }
    })
}
